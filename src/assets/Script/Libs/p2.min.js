!function(t){var e;"object"==typeof exports?module.exports=t():("undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t())}(function(){return function t(e,o,i){function n(s,a){if(!o[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var h=o[s]={exports:{}};e[s][0].call(h.exports,function(t){return n(e[s][1][t]||t)},h,h.exports,t,e,o,i)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e){function o(){}var i=t("./Scalar");e.exports=o,o.lineInt=function(t,e,o){o=o||0;var n,r,s,a,c,h,l,p=[0,0];return n=t[1][1]-t[0][1],r=t[0][0]-t[1][0],s=n*t[0][0]+r*t[0][1],a=e[1][1]-e[0][1],c=e[0][0]-e[1][0],h=a*e[0][0]+c*e[0][1],l=n*c-a*r,i.eq(l,0,o)||(p[0]=(c*s-r*h)/l,p[1]=(n*h-a*s)/l),p},o.segmentsIntersect=function(t,e,o,i){var n=e[0]-t[0],r=e[1]-t[1],s=i[0]-o[0],a=i[1]-o[1];if(s*r-a*n==0)return!1;var c=(n*(o[1]-t[1])+r*(t[0]-o[0]))/(s*r-a*n),h=(s*(t[1]-o[1])+a*(o[0]-t[0]))/(a*n-s*r);return c>=0&&1>=c&&h>=0&&1>=h}},{"./Scalar":4}],2:[function(t,e){function o(){}e.exports=o,o.area=function(t,e,o){return(e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1])},o.left=function(t,e,i){return o.area(t,e,i)>0},o.leftOn=function(t,e,i){return o.area(t,e,i)>=0},o.right=function(t,e,i){return o.area(t,e,i)<0},o.rightOn=function(t,e,i){return o.area(t,e,i)<=0};var i=[],n=[];o.collinear=function(t,e,r,s){if(s){var a=i,c=n;a[0]=e[0]-t[0],a[1]=e[1]-t[1],c[0]=r[0]-e[0],c[1]=r[1]-e[1];var h=a[0]*c[0]+a[1]*c[1],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]),p=Math.sqrt(c[0]*c[0]+c[1]*c[1]);return s>Math.acos(h/(l*p))}return 0==o.area(t,e,r)},o.sqdist=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i}},{}],3:[function(t,e){function o(){this.vertices=[]}function i(t,e,o,i,n){n=n||0;var r=e[1]-t[1],a=t[0]-e[0],c=r*t[0]+a*t[1],h=i[1]-o[1],l=o[0]-i[0],p=h*o[0]+l*o[1],u=r*l-h*a;return s.eq(u,0,n)?[0,0]:[(l*c-a*p)/u,(r*p-h*c)/u]}var n=t("./Line"),r=t("./Point"),s=t("./Scalar");e.exports=o,o.prototype.at=function(t){var e=this.vertices,o=e.length;return e[0>t?t%o+o:t%o]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(t,e,o){if(void 0===e)throw new Error("From is not given!");if(void 0===o)throw new Error("To is not given!");if(e>o-1)throw new Error("lol1");if(o>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var i=e;o>i;i++)this.vertices.push(t.vertices[i])},o.prototype.makeCCW=function(){for(var t=0,e=this.vertices,o=1;o<this.vertices.length;++o)(e[o][1]<e[t][1]||e[o][1]==e[t][1]&&e[o][0]>e[t][0])&&(t=o);r.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},o.prototype.reverse=function(){for(var t=[],e=0,o=this.vertices.length;e!==o;e++)t.push(this.vertices.pop());this.vertices=t},o.prototype.isReflex=function(t){return r.right(this.at(t-1),this.at(t),this.at(t+1))};var a=[],c=[];o.prototype.canSee=function(t,e){var o,i,s=a,h=c;if(r.leftOn(this.at(t+1),this.at(t),this.at(e))&&r.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;i=r.sqdist(this.at(t),this.at(e));for(var l=0;l!==this.vertices.length;++l)if((l+1)%this.vertices.length!==t&&l!==t&&r.leftOn(this.at(t),this.at(e),this.at(l+1))&&r.rightOn(this.at(t),this.at(e),this.at(l))&&(s[0]=this.at(t),s[1]=this.at(e),h[0]=this.at(l),h[1]=this.at(l+1),o=n.lineInt(s,h),r.sqdist(this.at(t),o)<i))return!1;return!0},o.prototype.copy=function(t,e,i){var n=i||new o;if(n.clear(),e>t)for(var r=t;e>=r;r++)n.vertices.push(this.vertices[r]);else{for(r=0;e>=r;r++)n.vertices.push(this.vertices[r]);for(r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},o.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new o,r=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var a=0;a<this.vertices.length;++a)if(this.canSee(s,a)){e=this.copy(s,a,n).getCutEdges(),i=this.copy(a,s,n).getCutEdges();for(var c=0;c<i.length;c++)e.push(i[c]);e.length<r&&(t=e,r=e.length,t.push([this.at(s),this.at(a)]))}return t},o.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},o.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],o=0;o<t.length;o++)for(var i=t[o],n=0;n<e.length;n++){var r=e[n].slice(i);if(r){e.splice(n,1),e.push(r[0],r[1]);break}}return e}return i=t,o=this.vertices.indexOf(i[0]),n=this.vertices.indexOf(i[1]),-1!=o&&-1!=n&&[this.copy(o,n),this.copy(n,o)]},o.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var o=0;e-1>o;o++)if(n.segmentsIntersect(t[e],t[e+1],t[o],t[o+1]))return!1;for(e=1;e<t.length-2;e++)if(n.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},o.prototype.quickDecomp=function(t,e,n,s,a,c){a=a||3e3,c=c||0,s=s||25,t=void 0!==t?t:[],e=e||[],n=n||[];var h=[0,0],l=[0,0],p=[0,0],u=0,d=0,f=0,v=0,y=0,m=0,g=0,A=new o,b=new o,E=this,B=this.vertices;if(B.length<3)return t;if(++c>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var q=0;q<this.vertices.length;++q)if(E.isReflex(q)){e.push(E.vertices[q]),u=d=Number.MAX_VALUE;for(var P=0;P<this.vertices.length;++P)r.left(E.at(q-1),E.at(q),E.at(P))&&r.rightOn(E.at(q-1),E.at(q),E.at(P-1))&&(p=i(E.at(q-1),E.at(q),E.at(P),E.at(P-1)),r.right(E.at(q+1),E.at(q),p)&&d>(f=r.sqdist(E.vertices[q],p))&&(d=f,l=p,m=P)),r.left(E.at(q+1),E.at(q),E.at(P+1))&&r.rightOn(E.at(q+1),E.at(q),E.at(P))&&(p=i(E.at(q+1),E.at(q),E.at(P),E.at(P+1)),r.left(E.at(q-1),E.at(q),p)&&u>(f=r.sqdist(E.vertices[q],p))&&(u=f,h=p,y=P));if(m==(y+1)%this.vertices.length)p[0]=(l[0]+h[0])/2,p[1]=(l[1]+h[1])/2,n.push(p),y>q?(A.append(E,q,y+1),A.vertices.push(p),b.vertices.push(p),0!=m&&b.append(E,m,E.vertices.length),b.append(E,0,q+1)):(0!=q&&A.append(E,q,E.vertices.length),A.append(E,0,y+1),A.vertices.push(p),b.vertices.push(p),b.append(E,m,q+1));else{if(m>y&&(y+=this.vertices.length),v=Number.MAX_VALUE,m>y)return t;for(P=m;y>=P;++P)r.leftOn(E.at(q-1),E.at(q),E.at(P))&&r.rightOn(E.at(q+1),E.at(q),E.at(P))&&v>(f=r.sqdist(E.at(q),E.at(P)))&&(v=f,g=P%this.vertices.length);g>q?(A.append(E,q,g+1),0!=g&&b.append(E,g,B.length),b.append(E,0,q+1)):(0!=q&&A.append(E,q,B.length),A.append(E,0,g+1),b.append(E,g,q+1))}return A.vertices.length<b.vertices.length?(A.quickDecomp(t,e,n,s,a,c),b.quickDecomp(t,e,n,s,a,c)):(b.quickDecomp(t,e,n,s,a,c),A.quickDecomp(t,e,n,s,a,c)),t}return t.push(this),t},o.prototype.removeCollinearPoints=function(t){for(var e=0,o=this.vertices.length-1;this.vertices.length>3&&o>=0;--o)r.collinear(this.at(o-1),this.at(o),this.at(o+1),t)&&(this.vertices.splice(o%this.vertices.length,1),o--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e){function o(){}e.exports=o,o.eq=function(t,e,o){return o=o||0,Math.abs(t-e)<o}},{}],5:[function(t,e){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e){e.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(t,e){function o(t){this.lowerBound=i.create(),t&&t.lowerBound&&i.copy(this.lowerBound,t.lowerBound),this.upperBound=i.create(),t&&t.upperBound&&i.copy(this.upperBound,t.upperBound)}var i=t("../math/vec2");t("../utils/Utils"),e.exports=o;var n=i.create();o.prototype.setFromPoints=function(t,e,o,r){var s=this.lowerBound,a=this.upperBound;"number"!=typeof o&&(o=0),0!==o?i.rotate(s,t[0],o):i.copy(s,t[0]),i.copy(a,s);for(var c=Math.cos(o),h=Math.sin(o),l=1;l<t.length;l++){var p=t[l];if(0!==o){var u=p[0],d=p[1];n[0]=c*u-h*d,n[1]=h*u+c*d,p=n}for(var f=0;2>f;f++)p[f]>a[f]&&(a[f]=p[f]),p[f]<s[f]&&(s[f]=p[f])}e&&(i.add(this.lowerBound,this.lowerBound,e),i.add(this.upperBound,this.upperBound,e)),r&&(this.lowerBound[0]-=r,this.lowerBound[1]-=r,this.upperBound[0]+=r,this.upperBound[1]+=r)},o.prototype.copy=function(t){i.copy(this.lowerBound,t.lowerBound),i.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var o=t.lowerBound[e];this.lowerBound[e]>o&&(this.lowerBound[e]=o);var i=t.upperBound[e];this.upperBound[e]<i&&(this.upperBound[e]=i)}},o.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return(i[0]<=o[0]&&o[0]<=n[0]||e[0]<=n[0]&&n[0]<=o[0])&&(i[1]<=o[1]&&o[1]<=n[1]||e[1]<=n[1]&&n[1]<=o[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,o=this.upperBound;return e[0]<=t[0]&&t[0]<=o[0]&&e[1]<=t[1]&&t[1]<=o[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],o=1/t.direction[1],i=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,r=(this.lowerBound[1]-t.from[1])*o,s=(this.upperBound[1]-t.from[1])*o,a=Math.max(Math.max(Math.min(i,n),Math.min(r,s))),c=Math.min(Math.min(Math.max(i,n),Math.max(r,s)));return 0>c?-1:a>c?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e){function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var i=t("../math/vec2"),n=t("../objects/Body");e.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(){};var r=i.create();o.boundingRadiusCheck=function(t,e){i.sub(r,t.position,e.position);var o=i.squaredLength(r),n=t.boundingRadius+e.boundingRadius;return n*n>=o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var o=n.KINEMATIC,i=n.STATIC;return!(t.type===i&&e.type===i||t.type===o&&e.type===i||t.type===i&&e.type===o||t.type===o&&e.type===o||t.sleepState===n.SLEEPING&&e.sleepState===n.SLEEPING||t.sleepState===n.SLEEPING&&e.type===i||e.sleepState===n.SLEEPING&&t.type===i)},o.NAIVE=1,o.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e){function o(){i.call(this,i.NAIVE)}var i=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.getCollisionPairs=function(t){var e=t.bodies,o=this.result;o.length=0;for(var n=0,r=e.length;n!==r;n++)for(var s=e[n],a=0;n>a;a++){var c=e[a];i.canCollide(s,c)&&this.boundingVolumeCheck(s,c)&&o.push(s,c)}return o},o.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=t.bodies,n=0;n<i.length;n++){var r=i[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&o.push(r)}return o}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e){function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new h({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=u.DEFAULT_STIFFNESS,this.relaxation=u.DEFAULT_RELAXATION,this.frictionStiffness=u.DEFAULT_STIFFNESS,this.frictionRelaxation=u.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new p,this.contactSkinSize=.01}function i(t,e){r.set(t.vertices[0],.5*-e.length,-e.radius),r.set(t.vertices[1],.5*e.length,-e.radius),r.set(t.vertices[2],.5*e.length,e.radius),r.set(t.vertices[3],.5*-e.length,e.radius)}function n(t,e,o,i){for(var n=j,c=X,h=z,l=Y,p=t,u=e.vertices,d=null,f=0;f!==u.length+1;f++){var v=u[f%u.length],y=u[(f+1)%u.length];r.rotate(n,v,i),r.rotate(c,y,i),a(n,n,o),a(c,c,o),s(h,n,p),s(l,c,p);var m=r.crossLength(h,l);if(null===d&&(d=m),0>=m*d)return!1;d=m}return!0}var r=t("../math/vec2"),s=r.sub,a=r.add,c=r.dot,h=(t("../utils/Utils"),t("../utils/ContactEquationPool")),l=t("../utils/FrictionEquationPool"),p=t("../utils/TupleDictionary"),u=t("../equations/Equation"),d=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),f=t("../shapes/Convex"),v=t("../shapes/Shape"),y=(t("../objects/Body"),t("../shapes/Box"));e.exports=o;var m=r.fromValues(0,1),g=r.fromValues(0,0),A=r.fromValues(0,0),b=r.fromValues(0,0),E=r.fromValues(0,0),B=r.fromValues(0,0),q=r.fromValues(0,0),P=r.fromValues(0,0),w=r.fromValues(0,0),S=r.fromValues(0,0),C=r.fromValues(0,0),L=r.fromValues(0,0),x=r.fromValues(0,0),F=r.fromValues(0,0),M=r.fromValues(0,0),I=r.fromValues(0,0),R=r.fromValues(0,0),V=r.fromValues(0,0),T=r.fromValues(0,0),N=[],G=r.create(),O=r.create();o.prototype.bodiesOverlap=function(t,e){for(var o=G,i=O,n=0,r=t.shapes.length;n!==r;n++){var s=t.shapes[n];t.toWorldFrame(o,s.position);for(var a=0,c=e.shapes.length;a!==c;a++){var h=e.shapes[a];if(e.toWorldFrame(i,h.position),this[s.type|h.type](t,s,o,s.angle+t.angle,e,h,i,h.angle+e.angle,!0))return!0}}return!1},o.prototype.collidedLastStep=function(t,e){var o=0|t.id,i=0|e.id;return!!this.collidingBodiesLastStep.get(o,i)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var o=t[e],i=o.bodyA.id,n=o.bodyB.id;this.collidingBodiesLastStep.set(i,n,!0)}for(var r=this.contactEquations,s=this.frictionEquations,a=0;a<r.length;a++)this.contactEquationPool.release(r[a]);for(a=0;a<s.length;a++)this.frictionEquationPool.release(s[a]);this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(t,e,o,i){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},o.prototype.createFrictionEquation=function(t,e,o,i){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},o.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return r.copy(e.contactPointA,t.contactPointA),r.copy(e.contactPointB,t.contactPointB),r.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},o.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],o=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;e.bodyB,r.set(o.contactPointA,0,0),r.set(o.contactPointB,0,0),r.set(o.t,0,0);for(var n=0;n!==t;n++)(e=this.contactEquations[this.contactEquations.length-1-n]).bodyA===i?(r.add(o.t,o.t,e.normalA),r.add(o.contactPointA,o.contactPointA,e.contactPointA),r.add(o.contactPointB,o.contactPointB,e.contactPointB)):(r.sub(o.t,o.t,e.normalA),r.add(o.contactPointA,o.contactPointA,e.contactPointB),r.add(o.contactPointB,o.contactPointB,e.contactPointA)),o.contactEquations.push(e);var s=1/t;return r.scale(o.contactPointA,o.contactPointA,s),r.scale(o.contactPointB,o.contactPointB,s),r.normalize(o.t,o.t),r.rotate90cw(o.t,o.t),o},o.prototype[v.LINE|v.CONVEX]=o.prototype.convexLine=function(t,e,o,i,n,r,s,a,c){return!c&&0},o.prototype[v.LINE|v.BOX]=o.prototype.lineBox=function(t,e,o,i,n,r,s,a,c){return!c&&0};var U=new y({width:1,height:1}),k=r.create();o.prototype[v.CAPSULE|v.CONVEX]=o.prototype[v.CAPSULE|v.BOX]=o.prototype.convexCapsule=function(t,e,o,n,s,a,c,h,l){var p=k;r.set(p,a.length/2,0),r.rotate(p,p,h),r.add(p,p,c);var u=this.circleConvex(s,a,p,h,t,e,o,n,l,a.radius);r.set(p,-a.length/2,0),r.rotate(p,p,h),r.add(p,p,c);var d=this.circleConvex(s,a,p,h,t,e,o,n,l,a.radius);if(l&&(u||d))return!0;var f=U;return i(f,a),this.convexConvex(t,e,o,n,s,f,c,h,l)+u+d},o.prototype[v.CAPSULE|v.LINE]=o.prototype.lineCapsule=function(t,e,o,i,n,r,s,a,c){return!c&&0};var _=r.create(),D=r.create(),W=new y({width:1,height:1});o.prototype[v.CAPSULE|v.CAPSULE]=o.prototype.capsuleCapsule=function(t,e,o,n,s,a,c,h,l){for(var p=_,u=D,d=0,f=0;2>f;f++){r.set(p,(0===f?-1:1)*e.length/2,0),r.rotate(p,p,n),r.add(p,p,o);for(var v=0;2>v;v++){r.set(u,(0===v?-1:1)*a.length/2,0),r.rotate(u,u,h),r.add(u,u,c),this.enableFrictionReduction&&(A=this.enableFriction,this.enableFriction=!1);var y=this.circleCircle(t,e,p,n,s,a,u,h,l,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=A),l&&y)return!0;d+=y}}this.enableFrictionReduction&&(A=this.enableFriction,this.enableFriction=!1);var m=W;i(m,e);var g=this.convexCapsule(t,m,o,n,s,a,c,h,l);if(this.enableFrictionReduction&&(this.enableFriction=A),l&&g)return!0;if(d+=g,this.enableFrictionReduction){var A=this.enableFriction;this.enableFriction=!1}i(m,a);var b=this.convexCapsule(s,m,c,h,t,e,o,n,l);return this.enableFrictionReduction&&(this.enableFriction=A),!(!l||!b)||(d+=b,this.enableFrictionReduction&&d&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(d)),d)},o.prototype[v.LINE|v.LINE]=o.prototype.lineLine=function(t,e,o,i,n,r,s,a,c){return!c&&0},o.prototype[v.PLANE|v.LINE]=o.prototype.planeLine=function(t,e,o,i,n,h,l,p,u){var d=g,f=A,v=b,y=E,C=B,L=q,x=P,F=w,M=S,I=N,R=0;r.set(d,-h.length/2,0),r.set(f,h.length/2,0),r.rotate(v,d,p),r.rotate(y,f,p),a(v,v,l),a(y,y,l),r.copy(d,v),r.copy(f,y),s(C,f,d),r.normalize(L,C),r.rotate90cw(M,L),r.rotate(F,m,i),I[0]=d,I[1]=f;for(var V=0;V<I.length;V++){var T=I[V];s(x,T,o);var G=c(x,F);if(0>G){if(u)return!0;var O=this.createContactEquation(t,n,e,h);R++,r.copy(O.normalA,F),r.normalize(O.normalA,O.normalA),r.scale(x,F,G),s(O.contactPointA,T,x),s(O.contactPointA,O.contactPointA,t.position),s(O.contactPointB,T,l),a(O.contactPointB,O.contactPointB,l),s(O.contactPointB,O.contactPointB,n.position),this.contactEquations.push(O),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}}return!u&&(this.enableFrictionReduction||R&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(R)),R)},o.prototype[v.PARTICLE|v.CAPSULE]=o.prototype.particleCapsule=function(t,e,o,i,n,r,s,a,c){return this.circleLine(t,e,o,i,n,r,s,a,c,r.radius,0)},o.prototype[v.CIRCLE|v.LINE]=o.prototype.circleLine=function(t,e,o,i,n,h,l,p,u,d,f){d=d||0,f=void 0!==f?f:e.radius;var v=g,y=A,m=b,I=E,R=B,V=q,T=P,G=w,O=S,U=C,k=L,_=x,D=F,W=M,j=N;r.set(G,-h.length/2,0),r.set(O,h.length/2,0),r.rotate(U,G,p),r.rotate(k,O,p),a(U,U,l),a(k,k,l),r.copy(G,U),r.copy(O,k),s(V,O,G),r.normalize(T,V),r.rotate90cw(R,T),s(_,o,G);var X=c(_,R);s(I,G,l),s(D,o,l);var z=f+d;if(Math.abs(X)<z){r.scale(v,R,X),s(m,o,v),r.scale(y,R,c(R,D)),r.normalize(y,y),r.scale(y,y,d),a(m,m,y);var Y=c(T,m),K=c(T,G),H=c(T,O);if(Y>K&&H>Y){if(u)return!0;var Z=this.createContactEquation(t,n,e,h);return r.scale(Z.normalA,v,-1),r.normalize(Z.normalA,Z.normalA),r.scale(Z.contactPointA,Z.normalA,f),a(Z.contactPointA,Z.contactPointA,o),s(Z.contactPointA,Z.contactPointA,t.position),s(Z.contactPointB,m,l),a(Z.contactPointB,Z.contactPointB,l),s(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}j[0]=G,j[1]=O;for(var J=0;J<j.length;J++){var Q=j[J];if(s(_,Q,o),r.squaredLength(_)<Math.pow(z,2))return!!u||(Z=this.createContactEquation(t,n,e,h),r.copy(Z.normalA,_),r.normalize(Z.normalA,Z.normalA),r.scale(Z.contactPointA,Z.normalA,f),a(Z.contactPointA,Z.contactPointA,o),s(Z.contactPointA,Z.contactPointA,t.position),s(Z.contactPointB,Q,l),r.scale(W,Z.normalA,-d),a(Z.contactPointB,Z.contactPointB,W),a(Z.contactPointB,Z.contactPointB,l),s(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1)}return 0},o.prototype[v.CIRCLE|v.CAPSULE]=o.prototype.circleCapsule=function(t,e,o,i,n,r,s,a,c){return this.circleLine(t,e,o,i,n,r,s,a,c,r.radius)},o.prototype[v.CIRCLE|v.CONVEX]=o.prototype[v.CIRCLE|v.BOX]=o.prototype.circleConvex=function(t,e,o,i,c,h,l,p,u,d){d="number"==typeof d?d:e.radius;for(var f=g,v=A,y=b,m=E,q=B,P=C,w=L,S=F,x=M,V=I,T=R,N=!1,G=Number.MAX_VALUE,O=h.vertices,U=0;U!==O.length+1;U++){var k=O[U%O.length],_=O[(U+1)%O.length];if(r.rotate(f,k,p),r.rotate(v,_,p),a(f,f,l),a(v,v,l),s(y,v,f),r.normalize(m,y),r.rotate90cw(q,m),r.scale(x,q,-e.radius),a(x,x,o),n(x,h,l,p)){r.sub(V,f,x);var D=Math.abs(r.dot(V,q));G>D&&(r.copy(T,x),G=D,r.scale(S,q,D),r.add(S,S,x),N=!0)}}if(N){if(u)return!0;var W=this.createContactEquation(t,c,e,h);return r.sub(W.normalA,T,o),r.normalize(W.normalA,W.normalA),r.scale(W.contactPointA,W.normalA,d),a(W.contactPointA,W.contactPointA,o),s(W.contactPointA,W.contactPointA,t.position),s(W.contactPointB,S,l),a(W.contactPointB,W.contactPointB,l),s(W.contactPointB,W.contactPointB,c.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}if(d>0)for(U=0;U<O.length;U++){var j=O[U];if(r.rotate(w,j,p),a(w,w,l),s(P,w,o),r.squaredLength(P)<Math.pow(d,2))return!!u||(W=this.createContactEquation(t,c,e,h),r.copy(W.normalA,P),r.normalize(W.normalA,W.normalA),r.scale(W.contactPointA,W.normalA,d),a(W.contactPointA,W.contactPointA,o),s(W.contactPointA,W.contactPointA,t.position),s(W.contactPointB,w,l),a(W.contactPointB,W.contactPointB,l),s(W.contactPointB,W.contactPointB,c.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1)}return 0};var j=r.create(),X=r.create(),z=r.create(),Y=r.create();o.prototype[v.PARTICLE|v.CONVEX]=o.prototype[v.PARTICLE|v.BOX]=o.prototype.particleConvex=function(t,e,o,i,h,l,p,u,d){var f=g,v=A,y=b,m=E,w=B,S=q,L=P,x=C,M=F,I=V,R=T,N=Number.MAX_VALUE,G=!1,O=l.vertices;if(!n(o,l,p,u))return 0;if(d)return!0;for(var U=0;U!==O.length+1;U++){var k=O[U%O.length],_=O[(U+1)%O.length];r.rotate(f,k,u),r.rotate(v,_,u),a(f,f,p),a(v,v,p),s(y,v,f),r.normalize(m,y),r.rotate90cw(w,m),s(x,o,f),c(x,w),s(S,f,p),s(L,o,p),r.sub(I,f,o);var D=Math.abs(r.dot(I,w));N>D&&(N=D,r.scale(M,w,D),r.add(M,M,o),r.copy(R,w),G=!0)}if(G){var W=this.createContactEquation(t,h,e,l);return r.scale(W.normalA,R,-1),r.normalize(W.normalA,W.normalA),r.set(W.contactPointA,0,0),a(W.contactPointA,W.contactPointA,o),s(W.contactPointA,W.contactPointA,t.position),s(W.contactPointB,M,p),a(W.contactPointB,W.contactPointB,p),s(W.contactPointB,W.contactPointB,h.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}return 0},o.prototype[v.CIRCLE]=o.prototype.circleCircle=function(t,e,o,i,n,c,h,l,p,u,d){var f=g;u=u||e.radius,d=d||c.radius,s(f,o,h);var v=u+d;if(r.squaredLength(f)>Math.pow(v,2))return 0;if(p)return!0;var y=this.createContactEquation(t,n,e,c);return s(y.normalA,h,o),r.normalize(y.normalA,y.normalA),r.scale(y.contactPointA,y.normalA,u),r.scale(y.contactPointB,y.normalA,-d),a(y.contactPointA,y.contactPointA,o),s(y.contactPointA,y.contactPointA,t.position),a(y.contactPointB,y.contactPointB,h),s(y.contactPointB,y.contactPointB,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},o.prototype[v.PLANE|v.CONVEX]=o.prototype[v.PLANE|v.BOX]=o.prototype.planeConvex=function(t,e,o,i,n,h,l,p,u){var d=g,f=A,v=b,y=0;r.rotate(f,m,i);for(var E=0;E!==h.vertices.length;E++){var B=h.vertices[E];if(r.rotate(d,B,p),a(d,d,l),s(v,d,o),c(v,f)<=0){if(u)return!0;y++;var q=this.createContactEquation(t,n,e,h);s(v,d,o),r.copy(q.normalA,f);var P=c(v,q.normalA);r.scale(v,q.normalA,P),s(q.contactPointB,d,n.position),s(q.contactPointA,d,v),s(q.contactPointA,q.contactPointA,t.position),this.contactEquations.push(q),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(q))}}return this.enableFrictionReduction&&this.enableFriction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},o.prototype[v.PARTICLE|v.PLANE]=o.prototype.particlePlane=function(t,e,o,i,n,a,h,l,p){var u=g,d=A;l=l||0,s(u,o,h),r.rotate(d,m,l);var f=c(u,d);if(f>0)return 0;if(p)return!0;var v=this.createContactEquation(n,t,a,e);return r.copy(v.normalA,d),r.scale(u,v.normalA,f),s(v.contactPointA,o,u),s(v.contactPointA,v.contactPointA,n.position),s(v.contactPointB,o,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},o.prototype[v.CIRCLE|v.PARTICLE]=o.prototype.circleParticle=function(t,e,o,i,n,c,h,l,p){var u=g;if(s(u,h,o),r.squaredLength(u)>Math.pow(e.radius,2))return 0;if(p)return!0;var d=this.createContactEquation(t,n,e,c);return r.copy(d.normalA,u),r.normalize(d.normalA,d.normalA),r.scale(d.contactPointA,d.normalA,e.radius),a(d.contactPointA,d.contactPointA,o),s(d.contactPointA,d.contactPointA,t.position),s(d.contactPointB,h,n.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var K=new d({radius:1}),H=r.create(),Z=r.create();r.create(),o.prototype[v.PLANE|v.CAPSULE]=o.prototype.planeCapsule=function(t,e,o,i,n,s,c,h,l){var p,u=H,d=Z,f=K;r.set(u,-s.length/2,0),r.rotate(u,u,h),a(u,u,c),r.set(d,s.length/2,0),r.rotate(d,d,h),a(d,d,c),f.radius=s.radius,this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,f,u,0,t,e,o,i,l),y=this.circlePlane(n,f,d,0,t,e,o,i,l);if(this.enableFrictionReduction&&(this.enableFriction=p),l)return v||y;var m=v+y;return this.enableFrictionReduction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},o.prototype[v.CIRCLE|v.PLANE]=o.prototype.circlePlane=function(t,e,o,i,n,h,l,p,u){var d=t,f=e,v=o,y=n,E=l,B=p;B=B||0;var q=g,P=A,w=b;s(q,v,E),r.rotate(P,m,B);var S=c(P,q);if(S>f.radius)return 0;if(u)return!0;var C=this.createContactEquation(y,d,h,e);return r.copy(C.normalA,P),r.scale(C.contactPointB,C.normalA,-f.radius),a(C.contactPointB,C.contactPointB,v),s(C.contactPointB,C.contactPointB,d.position),r.scale(w,C.normalA,S),s(C.contactPointA,q,w),a(C.contactPointA,C.contactPointA,E),s(C.contactPointA,C.contactPointA,y.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),1},o.prototype[v.CONVEX]=o.prototype[v.CONVEX|v.BOX]=o.prototype[v.BOX]=o.prototype.convexConvex=function(t,e,i,n,h,l,p,u,d,f){var v=g,y=A,m=b,q=E,C=B,L=P,x=w,F=S,M=0;if(f="number"==typeof f?f:0,!o.findSeparatingAxis(e,i,n,l,p,u,v))return 0;s(x,p,i),c(v,x)>0&&r.scale(v,v,-1);var I=o.getClosestEdge(e,n,v,!0),R=o.getClosestEdge(l,u,v);if(-1===I||-1===R)return 0;for(var V=0;2>V;V++){var T,N=I,G=R,O=e,U=l,k=i,_=p,D=n,W=u,j=t,X=h;0===V&&(T=N,N=G,G=T,T=O,O=U,U=T,T=k,k=_,_=T,T=D,D=W,W=T,T=j,j=X,X=T);for(var z=G;G+2>z;z++){var Y=U.vertices[(z+U.vertices.length)%U.vertices.length];r.rotate(y,Y,W),a(y,y,_);for(var K=0,H=N-1;N+2>H;H++){var Z=O.vertices[(H+O.vertices.length)%O.vertices.length],J=O.vertices[(H+1+O.vertices.length)%O.vertices.length];r.rotate(m,Z,D),r.rotate(q,J,D),a(m,m,k),a(q,q,k),s(C,q,m),r.rotate90cw(F,C),r.normalize(F,F),s(x,y,m);var Q=c(F,x);(H===N&&f>=Q||H!==N&&0>=Q)&&K++}if(K>=3){if(d)return!0;var $=this.createContactEquation(j,X,O,U);M++,Z=O.vertices[N%O.vertices.length],J=O.vertices[(N+1)%O.vertices.length],r.rotate(m,Z,D),r.rotate(q,J,D),a(m,m,k),a(q,q,k),s(C,q,m),r.rotate90cw($.normalA,C),r.normalize($.normalA,$.normalA),s(x,y,m),Q=c($.normalA,x),r.scale(L,$.normalA,Q),s($.contactPointA,y,k),s($.contactPointA,$.contactPointA,L),a($.contactPointA,$.contactPointA,k),s($.contactPointA,$.contactPointA,j.position),s($.contactPointB,y,_),a($.contactPointB,$.contactPointB,_),s($.contactPointB,$.contactPointB,X.position),this.contactEquations.push($),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($))}}}return this.enableFrictionReduction&&this.enableFriction&&M&&this.frictionEquations.push(this.createFrictionFromAverage(M)),M};var J=r.fromValues(0,0);o.projectConvexOntoAxis=function(t,e,o,i,n){var s,a,h=null,l=null,p=J;r.rotate(p,i,-o);for(var u=0;u<t.vertices.length;u++)s=t.vertices[u],a=c(s,p),(null===h||a>h)&&(h=a),(null===l||l>a)&&(l=a);if(l>h){var d=l;l=h,h=d}var f=c(e,i);r.set(n,l+f,h+f)};var Q=r.fromValues(0,0),$=r.fromValues(0,0),tt=r.fromValues(0,0),et=r.fromValues(0,0),ot=r.fromValues(0,0),it=r.fromValues(0,0);o.findSeparatingAxis=function(t,e,i,n,a,c,h){var l=null,p=!1,u=!1,d=Q,f=$,v=tt,m=et,g=ot,A=it;if(t instanceof y&&n instanceof y)for(var b=0;2!==b;b++){var E=t,B=i;1===b&&(E=n,B=c);for(var q=0;2!==q;q++){0===q?r.set(m,0,1):1===q&&r.set(m,1,0),0!==B&&r.rotate(m,m,B),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,a,c,m,A);var P=g,w=A;g[0]>A[0]&&(w=g,P=A),p=0>=(S=w[0]-P[1]),(null===l||S>l)&&(r.copy(h,m),l=S,u=p)}}else for(b=0;2!==b;b++)for(E=t,B=i,1===b&&(E=n,B=c),q=0;q!==E.vertices.length;q++){var S;r.rotate(f,E.vertices[q],B),r.rotate(v,E.vertices[(q+1)%E.vertices.length],B),s(d,v,f),r.rotate90cw(m,d),r.normalize(m,m),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,a,c,m,A),P=g,w=A,g[0]>A[0]&&(w=g,P=A),p=0>=(S=w[0]-P[1]),(null===l||S>l)&&(r.copy(h,m),l=S,u=p)}return u};var nt=r.fromValues(0,0),rt=r.fromValues(0,0),st=r.fromValues(0,0);o.getClosestEdge=function(t,e,o,i){var n=nt,a=rt,h=st;r.rotate(n,o,-e),i&&r.scale(n,n,-1);for(var l=-1,p=t.vertices.length,u=-1,d=0;d!==p;d++){s(a,t.vertices[(d+1)%p],t.vertices[d%p]),r.rotate90cw(h,a),r.normalize(h,h);var f=c(h,n);(-1===l||f>u)&&(l=d%p,u=f)}return l};var at=r.create(),ct=r.create(),ht=r.create(),lt=r.create(),pt=r.create(),ut=r.create(),dt=r.create();o.prototype[v.CIRCLE|v.HEIGHTFIELD]=o.prototype.circleHeightfield=function(t,e,o,i,n,c,h,l,p,u){var d=c.heights,f=(u=u||e.radius,c.elementWidth),v=ct,y=at,m=pt,g=dt,A=ut,b=ht,E=lt,B=Math.floor((o[0]-u-h[0])/f),q=Math.ceil((o[0]+u-h[0])/f);0>B&&(B=0),q>=d.length&&(q=d.length-1);for(var P=d[B],w=d[q],S=B;q>S;S++)d[S]<w&&(w=d[S]),d[S]>P&&(P=d[S]);if(o[1]-u>P)return!p&&0;var C=!1;for(S=B;q>S;S++){r.set(b,S*f,d[S]),r.set(E,(S+1)*f,d[S+1]),r.add(b,b,h),r.add(E,E,h),r.sub(A,E,b),r.rotate(A,A,Math.PI/2),r.normalize(A,A),r.scale(y,A,-u),r.add(y,y,o),r.sub(v,y,b);var L=r.dot(v,A);if(y[0]>=b[0]&&y[0]<E[0]&&0>=L){if(p)return!0;C=!0,r.scale(v,A,-L),r.add(m,y,v),r.copy(g,A);var x=this.createContactEquation(n,t,c,e);r.copy(x.normalA,g),r.scale(x.contactPointB,x.normalA,-u),a(x.contactPointB,x.contactPointB,o),s(x.contactPointB,x.contactPointB,t.position),r.copy(x.contactPointA,m),r.sub(x.contactPointA,x.contactPointA,n.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}if(C=!1,u>0)for(S=B;q>=S;S++)if(r.set(b,S*f,d[S]),r.add(b,b,h),r.sub(v,o,b),r.squaredLength(v)<Math.pow(u,2)){if(p)return!0;C=!0,x=this.createContactEquation(n,t,c,e),r.copy(x.normalA,v),r.normalize(x.normalA,x.normalA),r.scale(x.contactPointB,x.normalA,-u),a(x.contactPointB,x.contactPointB,o),s(x.contactPointB,x.contactPointB,t.position),s(x.contactPointA,b,h),a(x.contactPointA,x.contactPointA,h),s(x.contactPointA,x.contactPointA,n.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}return C?1:0};var ft=r.create(),vt=r.create(),yt=r.create(),mt=new f({vertices:[r.create(),r.create(),r.create(),r.create()]});o.prototype[v.BOX|v.HEIGHTFIELD]=o.prototype[v.CONVEX|v.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,o,i,n,s,a,c,h){var l=s.heights,p=s.elementWidth,u=ft,d=vt,f=yt,v=mt,y=Math.floor((t.aabb.lowerBound[0]-a[0])/p),m=Math.ceil((t.aabb.upperBound[0]-a[0])/p);0>y&&(y=0),m>=l.length&&(m=l.length-1);for(var g=l[y],A=l[m],b=y;m>b;b++)l[b]<A&&(A=l[b]),l[b]>g&&(g=l[b]);if(t.aabb.lowerBound[1]>g)return!h&&0;var E=0;for(b=y;m>b;b++)r.set(u,b*p,l[b]),r.set(d,(b+1)*p,l[b+1]),r.add(u,u,a),r.add(d,d,a),r.set(f,.5*(d[0]+u[0]),.5*(d[1]+u[1]-100)),r.sub(v.vertices[0],d,f),r.sub(v.vertices[1],u,f),r.copy(v.vertices[2],v.vertices[1]),r.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=100,v.vertices[3][1]-=100,E+=this.convexConvex(t,e,o,i,n,v,f,0,h);return E}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e){function o(t){t=t||{},this.from=t.from?n.fromValues(t.from[0],t.from[1]):n.create(),this.to=t.to?n.fromValues(t.to[0],t.to[1]):n.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(){},this.direction=n.create(),this.length=1,this.update()}function i(t,e,o){n.sub(s,o,t);var i=n.dot(s,e);return n.scale(a,e,i),n.add(a,a,t),n.squaredDistance(o,a)}e.exports=o;var n=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB"),o.prototype.constructor=o,o.CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;n.sub(t,this.to,this.from),this.length=n.length(t),n.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var o=0,i=e.length;!t.shouldStop(this)&&i>o;o++){var n=e[o],r=n.getAABB();(r.overlapsRay(this)>=0||r.containsPoint(this.from))&&this.intersectBody(t,n)}};var r=n.create();o.prototype.intersectBody=function(t,e){var o=this.checkCollisionResponse;if(!o||e.collisionResponse)for(var i=r,s=0,a=e.shapes.length;a>s;s++){var c=e.shapes[s];if((!o||c.collisionResponse)&&0!=(this.collisionGroup&c.collisionMask)&&0!=(c.collisionGroup&this.collisionMask)){n.rotate(i,c.position,e.angle),n.add(i,i,e.position);var h=c.angle+e.angle;if(this.intersectShape(t,c,h,i,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,o,n,r){i(this.from,this.direction,n)>e.boundingRadius*e.boundingRadius||(this._currentBody=r,this._currentShape=e,e.raycast(t,this,n,o),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,o=this.from;n.set(t.lowerBound,Math.min(e[0],o[0]),Math.min(e[1],o[1])),n.set(t.upperBound,Math.max(e[0],o[0]),Math.max(e[1],o[1]))},n.create(),o.prototype.reportIntersection=function(t,e,i,r){var s=(this.from,this.to,this._currentShape),a=this._currentBody;if(!(this.skipBackfaces&&n.dot(i,this.direction)>0))switch(this.mode){case o.ALL:t.set(i,s,a,e,r),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,s,a,e,r);break;case o.ANY:t.set(i,s,a,e,r)}};var s=n.create(),a=n.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e){function o(){this.normal=i.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var i=t("../math/vec2"),n=t("../collision/Ray");e.exports=o,o.prototype.reset=function(){i.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return i.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(t,e){i.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===n.ANY},o.prototype.set=function(t,e,o,n,r){i.copy(this.normal,t),this.shape=e,this.body=o,this.fraction=n,this.faceIndex=r}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e){function o(){n.call(this,n.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var o=t.axisList.indexOf(e.body);-1!==o&&t.axisList.splice(o,1)}}var i=t("../utils/Utils"),n=t("../collision/Broadphase");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,i.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e|=0;for(var o=1,i=t.length;i>o;o++){for(var n=t[o],r=o-1;r>=0&&!(t[r].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=n}return t},o.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;o.sortAxisList(t,e)},o.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,o=this.axisIndex;e.length=0;for(var i=t.length;i--;){var r=t[i];r.aabbNeedsUpdate&&r.updateAABB()}this.sortList();for(var s=0,a=0|t.length;s!==a;s++)for(var c=t[s],h=s+1;a>h;h++){var l=t[h];if(!(l.aabb.lowerBound[o]<=c.aabb.upperBound[o]))break;n.canCollide(c,l)&&this.boundingVolumeCheck(c,l)&&e.push(c,l)}return e},o.prototype.aabbQuery=function(t,e,o){o=o||[],this.sortList();var i=this.axisIndex,n="x";1===i&&(n="y"),2===i&&(n="z");for(var r=this.axisList,s=(e.lowerBound[n],e.upperBound[n],0);s<r.length;s++){var a=r[s];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&o.push(a)}return o}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e){function o(t,e,o,n){this.type=o,n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=o;var i=t("../utils/Utils");o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.stiffness=t,i.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.relaxation=t,i.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e){function o(t,e,o){o=s.defaults(o,{localAnchorA:[0,0],localAnchorB:[0,0]}),i.call(this,t,e,i.DISTANCE,o),this.localAnchorA=r.fromValues(o.localAnchorA[0],o.localAnchorA[1]),this.localAnchorB=r.fromValues(o.localAnchorB[0],o.localAnchorB[1]);var a,c=this.localAnchorA,h=this.localAnchorB;if(this.distance=0,"number"==typeof o.distance)this.distance=o.distance;else{var l=r.create(),p=r.create(),u=r.create();r.rotate(l,c,t.angle),r.rotate(p,h,e.angle),r.add(u,e.position,p),r.sub(u,u,l),r.sub(u,u,t.position),this.distance=r.length(u)}a=void 0===o.maxForce?Number.MAX_VALUE:o.maxForce;var d=new n(t,e,-a,a);this.equations=[d],this.maxForce=a,u=r.create();var f=r.create(),v=r.create(),y=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,o=t.position,i=e.position;return r.rotate(f,c,t.angle),r.rotate(v,h,e.angle),r.add(u,i,v),r.sub(u,u,f),r.sub(u,u,o),r.length(u)-y.distance},this.setMaxForce(a),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var i=t("./Constraint"),n=t("../equations/Equation"),r=t("../math/vec2"),s=t("../utils/Utils");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var a=r.create(),c=r.create(),h=r.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,o=this.bodyB,i=(this.distance,e.position),n=o.position,s=this.equations[0],l=t.G;r.rotate(c,this.localAnchorA,e.angle),r.rotate(h,this.localAnchorB,o.angle),r.add(a,n,h),r.sub(a,a,c),r.sub(a,a,i),this.position=r.length(a);var p=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,p=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,p=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||p){s.enabled=!0,r.normalize(a,a);var u=r.crossLength(c,a),d=r.crossLength(h,a);l[0]=-a[0],l[1]=-a[1],l[2]=-u,l[3]=a[0],l[4]=a[1],l[5]=d}else s.enabled=!1},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.GEAR,o),this.ratio=void 0!==o.ratio?o.ratio:1,this.angle=void 0!==o.angle?o.angle:e.angle-this.ratio*t.angle,o.angle=this.angle,o.ratio=this.ratio,this.equations=[new n(t,e,o)],void 0!==o.maxTorque&&this.setMaxTorque(o.maxTorque)}var i=t("./Constraint"),n=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.LOCK,o);var s=void 0===o.maxForce?Number.MAX_VALUE:o.maxForce,a=(o.localAngleB,new r(t,e,-s,s)),c=new r(t,e,-s,s),h=new r(t,e,-s,s),l=n.create(),p=n.create(),u=this;a.computeGq=function(){return n.rotate(l,u.localOffsetB,t.angle),n.sub(p,e.position,t.position),n.sub(p,p,l),p[0]},c.computeGq=function(){return n.rotate(l,u.localOffsetB,t.angle),n.sub(p,e.position,t.position),n.sub(p,p,l),p[1]};var d=n.create(),f=n.create();h.computeGq=function(){return n.rotate(d,u.localOffsetB,e.angle-u.localAngleB),n.scale(d,d,-1),n.sub(p,t.position,e.position),n.add(p,p,d),n.rotate(f,d,-Math.PI/2),n.normalize(f,f),n.dot(p,f)},this.localOffsetB=n.create(),o.localOffsetB?n.copy(this.localOffsetB,o.localOffsetB):(n.sub(this.localOffsetB,e.position,t.position),n.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof o.localAngleB?this.localAngleB=o.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(a,c,h),this.setMaxForce(s)}var i=t("./Constraint"),n=t("../math/vec2"),r=t("../equations/Equation");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setMaxForce=function(t){for(var e=this.equations,o=0;o<this.equations.length;o++)e[o].maxForce=t,e[o].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=n.create(),a=n.create(),c=n.create(),h=n.fromValues(1,0),l=n.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],o=this.equations[2],i=this.bodyA,r=this.bodyB;n.rotate(s,this.localOffsetB,i.angle),n.rotate(a,this.localOffsetB,r.angle-this.localAngleB),n.scale(a,a,-1),n.rotate(c,a,Math.PI/2),n.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-n.crossLength(s,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-n.crossLength(s,l),e.G[4]=1,o.G[0]=-c[0],o.G[1]=-c[1],o.G[3]=c[0],o.G[4]=c[1],o.G[5]=n.crossLength(a,c)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.PRISMATIC,o);var c=s.fromValues(0,0),h=s.fromValues(1,0),l=s.fromValues(0,0);o.localAnchorA&&s.copy(c,o.localAnchorA),o.localAxisA&&s.copy(h,o.localAxisA),o.localAnchorB&&s.copy(l,o.localAnchorB),this.localAnchorA=c,this.localAnchorB=l,this.localAxisA=h;var p=this.maxForce=void 0!==o.maxForce?o.maxForce:Number.MAX_VALUE,u=new r(t,e,-p,p),d=new s.create,f=new s.create,v=new s.create,y=new s.create;if(u.computeGq=function(){return s.dot(v,y)},u.updateJacobian=function(){var o=this.G,i=t.position,n=e.position;s.rotate(d,c,t.angle),s.rotate(f,l,e.angle),s.add(v,n,f),s.sub(v,v,i),s.sub(v,v,d),s.rotate(y,h,t.angle+Math.PI/2),o[0]=-y[0],o[1]=-y[1],o[2]=-s.crossLength(d,y)+s.crossLength(y,v),o[3]=y[0],o[4]=y[1],o[5]=s.crossLength(f,y)},this.equations.push(u),!o.disableRotationalLock){var m=new a(t,e,-p,p);this.equations.push(m)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==o.lowerLimit,this.upperLimitEnabled=void 0!==o.upperLimit,this.lowerLimit=void 0!==o.lowerLimit?o.lowerLimit:0,this.upperLimit=void 0!==o.upperLimit?o.upperLimit:1,this.upperLimitEquation=new n(t,e),this.lowerLimitEquation=new n(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=p,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.motorSpeed=0;var g=this,A=this.motorEquation;A.computeGW,A.computeGq=function(){return 0},A.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,s=o.angularVelocity;return this.gmult(t,i,r,n,s)+g.motorSpeed}}var i=t("./Constraint"),n=t("../equations/ContactEquation"),r=t("../equations/Equation"),s=t("../math/vec2"),a=t("../equations/RotationalLockEquation");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var c=s.create(),h=s.create(),l=s.create(),p=s.create(),u=s.create(),d=s.create();o.prototype.update=function(){var t=this.equations,e=t[0],o=this.upperLimit,i=this.lowerLimit,n=this.upperLimitEquation,r=this.lowerLimitEquation,a=this.bodyA,f=this.bodyB,v=this.localAxisA,y=this.localAnchorA,m=this.localAnchorB;e.updateJacobian(),s.rotate(c,v,a.angle),s.rotate(p,y,a.angle),s.add(h,p,a.position),s.rotate(u,m,f.angle),s.add(l,u,f.position);var g,A=this.position=s.dot(l,c)-s.dot(h,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=s.crossLength(c,u),b[3]=-c[0],b[4]=-c[1],b[5]=-s.crossLength(c,p)}this.upperLimitEnabled&&A>o?(s.scale(n.normalA,c,-1),s.sub(n.contactPointA,h,a.position),s.sub(n.contactPointB,l,f.position),s.scale(d,c,o),s.add(n.contactPointA,n.contactPointA,d),-1===t.indexOf(n)&&t.push(n)):-1!==(g=t.indexOf(n))&&t.splice(g,1),this.lowerLimitEnabled&&i>A?(s.scale(r.normalA,c,1),s.sub(r.contactPointA,h,a.position),s.sub(r.contactPointB,l,f.position),s.scale(d,c,i),s.sub(r.contactPointB,r.contactPointB,d),-1===t.indexOf(r)&&t.push(r)):-1!==(g=t.indexOf(r))&&t.splice(g,1)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.REVOLUTE,o);var d=this.maxForce=void 0!==o.maxForce?o.maxForce:Number.MAX_VALUE;this.pivotA=a.create(),this.pivotB=a.create(),o.worldPivot?(a.sub(this.pivotA,o.worldPivot,t.position),a.sub(this.pivotB,o.worldPivot,e.position),a.rotate(this.pivotA,this.pivotA,-t.angle),a.rotate(this.pivotB,this.pivotB,-e.angle)):(a.copy(this.pivotA,o.localPivotA),a.copy(this.pivotB,o.localPivotB));var f=this.equations=[new n(t,e,-d,d),new n(t,e,-d,d)],v=f[0],y=f[1],m=this;v.computeGq=function(){return a.rotate(c,m.pivotA,t.angle),a.rotate(h,m.pivotB,e.angle),a.add(u,e.position,h),a.sub(u,u,t.position),a.sub(u,u,c),a.dot(u,l)},y.computeGq=function(){return a.rotate(c,m.pivotA,t.angle),a.rotate(h,m.pivotB,e.angle),a.add(u,e.position,h),a.sub(u,u,t.position),a.sub(u,u,c),a.dot(u,p)},y.minForce=v.minForce=-d,y.maxForce=v.maxForce=d,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new s(t,e),this.lowerLimitEquation=new s(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var i=t("./Constraint"),n=t("../equations/Equation"),r=t("../equations/RotationalVelocityEquation"),s=t("../equations/RotationalLockEquation"),a=t("../math/vec2");e.exports=o;var c=a.create(),h=a.create(),l=a.fromValues(1,0),p=a.fromValues(0,1),u=a.create();o.prototype=new i,o.prototype.constructor=o,o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t,e=this.bodyA,o=this.bodyB,i=this.pivotA,n=this.pivotB,r=this.equations,s=(r[0],r[1],r[0]),u=r[1],d=this.upperLimit,f=this.lowerLimit,v=this.upperLimitEquation,y=this.lowerLimitEquation,m=this.angle=o.angle-e.angle;this.upperLimitEnabled&&m>d?(v.angle=d,-1===r.indexOf(v)&&r.push(v)):-1!==(t=r.indexOf(v))&&r.splice(t,1),this.lowerLimitEnabled&&f>m?(y.angle=f,-1===r.indexOf(y)&&r.push(y)):-1!==(t=r.indexOf(y))&&r.splice(t,1),a.rotate(c,i,e.angle),a.rotate(h,n,o.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-a.crossLength(c,l),s.G[3]=1,s.G[4]=0,s.G[5]=a.crossLength(h,l),u.G[0]=0,u.G[1]=-1,u.G[2]=-a.crossLength(c,p),u.G[3]=0,u.G[4]=1,u.G[5]=a.crossLength(h,p)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0,this.ratio="number"==typeof o.ratio?o.ratio:1,this.setRatio(this.ratio)}var i=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e){function o(t,e){i.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=n.create(),this.penetrationVec=n.create(),this.contactPointB=n.create(),this.normalA=n.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var i=t("./Equation"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var i,r,s=this.bodyA,a=this.bodyB,c=this.contactPointA,h=this.contactPointB,l=s.position,p=a.position,u=this.penetrationVec,d=this.normalA,f=this.G,v=n.crossLength(c,d),y=n.crossLength(h,d);return f[0]=-d[0],f[1]=-d[1],f[2]=-v,f[3]=d[0],f[4]=d[1],f[5]=y,n.add(u,p,h),n.sub(u,u,l),n.sub(u,u,c),this.firstImpact&&0!==this.restitution?(r=0,i=1/e*(1+this.restitution)*this.computeGW()):(r=n.dot(d,u)+this.offset,i=this.computeGW()),-r*t-i*e-o*this.computeGiMf()};var r=n.create(),s=n.create(),a=n.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(r,this.contactPointA),this.bodyB.getVelocityAtPoint(s,this.contactPointB),n.subtract(a,r,s),n.dot(this.normalA,a)}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e){function o(t,e,i,r){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new n.ARRAY_TYPE(6);for(var s=0;6>s;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=o;var i=t("../math/vec2"),n=t("../utils/Utils");t("../objects/Body"),o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,o=this.timeStep;this.a=4/(o*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(o*o*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,o,i,n){return t[0]*e[0]+t[1]*e[1]+t[2]*o+t[3]*i[0]+t[4]*i[1]+t[5]*n},o.prototype.computeB=function(t,e,o){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*o};var r=i.create(),s=i.create();o.prototype.computeGq=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=(e.position,o.position,e.angle),n=o.angle;return this.gmult(t,r,i,s,n)+this.offset},o.prototype.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,s=o.angularVelocity;return this.gmult(t,i,r,n,s)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.vlambda,n=o.vlambda,r=e.wlambda,s=o.wlambda;return this.gmult(t,i,r,n,s)};var a=i.create(),c=i.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,o=t.force,n=t.angularForce,r=e.force,s=e.angularForce,h=t.invMassSolve,l=e.invMassSolve,p=t.invInertiaSolve,u=e.invInertiaSolve,d=this.G;return i.scale(a,o,h),i.multiply(a,t.massMultiplier,a),i.scale(c,r,l),i.multiply(c,e.massMultiplier,c),this.gmult(d,a,n*p,c,s*u)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,o=t.invMassSolve,i=e.invMassSolve,n=t.invInertiaSolve,r=e.invInertiaSolve,s=this.G;return s[0]*s[0]*o*t.massMultiplier[0]+s[1]*s[1]*o*t.massMultiplier[1]+s[2]*s[2]*n+s[3]*s[3]*i*e.massMultiplier[0]+s[4]*s[4]*i*e.massMultiplier[1]+s[5]*s[5]*r};var h=i.create(),l=i.create(),p=i.create();i.create(),i.create(),i.create(),o.prototype.addToWlambda=function(t){var e=this.bodyA,o=this.bodyB,n=h,r=l,s=p,a=e.invMassSolve,c=o.invMassSolve,u=e.invInertiaSolve,d=o.invInertiaSolve,f=this.G;r[0]=f[0],r[1]=f[1],s[0]=f[3],s[1]=f[4],i.scale(n,r,a*t),i.multiply(n,n,e.massMultiplier),i.add(e.vlambda,e.vlambda,n),e.wlambda+=u*f[2]*t,i.scale(n,s,c*t),i.multiply(n,n,o.massMultiplier),i.add(o.vlambda,o.vlambda,n),o.wlambda+=d*f[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e){function o(t,e,o){n.call(this,t,e,-o,o),this.contactPointA=i.create(),this.contactPointB=i.create(),this.t=i.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var i=t("../math/vec2"),n=t("./Equation");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,o){var n=(this.bodyA,this.bodyB,this.contactPointA),r=this.contactPointB,s=this.t,a=this.G;return a[0]=-s[0],a[1]=-s[1],a[2]=-i.crossLength(n,s),a[3]=s[0],a[4]=s[1],a[5]=i.crossLength(r,s),-this.computeGW()*e-o*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0;var n=this.G;n[2]=1,n[5]=-1}var i=t("./Equation"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var r=n.create(),s=n.create(),a=n.fromValues(1,0),c=n.fromValues(0,1);o.prototype.computeGq=function(){return n.rotate(r,a,this.bodyA.angle+this.angle),n.rotate(s,c,this.bodyB.angle),n.dot(r,s)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e){function o(t,e){i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var i=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var i=this.G;i[2]=-1,i[5]=this.ratio;var n=this.computeGiMf();return-this.computeGW()*e-o*n}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e){var o=function(){};e.exports=o,o.prototype={constructor:o,on:function(t,e,o){e.context=o||this,void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;if(e){if(void 0!==o[t]&&-1!==o[t].indexOf(e))return!0}else if(void 0!==o[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var o=this._listeners,i=o[t].indexOf(e);return-1!==i&&o[t].splice(i,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var o=0,i=e.length;i>o;o++){var n=e[o];n.call(n.context,t)}}return this}}},{}],27:[function(t,e){function o(t,e,r){if(r=r||{},!(t instanceof i&&e instanceof i))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==r.friction?Number(r.friction):.3,this.restitution=void 0!==r.restitution?Number(r.restitution):0,this.stiffness=void 0!==r.stiffness?Number(r.stiffness):n.DEFAULT_STIFFNESS,this.relaxation=void 0!==r.relaxation?Number(r.relaxation):n.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==r.frictionStiffness?Number(r.frictionStiffness):n.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==r.frictionRelaxation?Number(r.frictionRelaxation):n.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==r.surfaceVelocity?Number(r.surfaceVelocity):0,this.contactSkinSize=.005}var i=t("./Material"),n=t("../equations/Equation");e.exports=o,o.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e){function o(t){this.id=t||o.idCounter++}e.exports=o,o.idCounter=0},{}],29:[function(t,e){var o={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,o=0,i=0;e>i;i+=2)o+=(t[i+2]-t[i])*(t[i+1]+t[i+3]);return.5*-(o+=(t[0]-t[e])*(t[e+1]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(3>e)return[];for(var i=[],n=[],r=0;e>r;r++)n.push(r);r=0;for(var s=e;s>3;){var a=n[(r+0)%s],c=n[(r+1)%s],h=n[(r+2)%s],l=t[2*a],p=t[2*a+1],u=t[2*c],d=t[2*c+1],f=t[2*h],v=t[2*h+1],y=!1;if(o._convex(l,p,u,d,f,v)){y=!0;for(var m=0;s>m;m++){var g=n[m];if(g!=a&&g!=c&&g!=h&&o._PointInTriangle(t[2*g],t[2*g+1],l,p,u,d,f,v)){y=!1;break}}}if(y)i.push(a,c,h),n.splice((r+1)%s,1),s--,r=0;else if(r++>3*s)break}return i.push(n[0],n[1],n[2]),i},_PointInTriangle:function(t,e,o,i,n,r,s,a){var c=s-o,h=a-i,l=n-o,p=r-i,u=t-o,d=e-i,f=c*c+h*h,v=c*l+h*p,y=c*u+h*d,m=l*l+p*p,g=l*u+p*d,A=1/(f*m-v*v),b=(m*y-v*g)*A,E=(f*g-v*y)*A;return b>=0&&E>=0&&1>b+E},_convex:function(t,e,o,i,n,r){return(e-i)*(n-o)+(o-t)*(r-i)>=0}};e.exports=o},{}],30:[function(t,e){var o=e.exports={},i=t("../utils/Utils");o.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},o.crossVZ=function(t,e,i){return o.rotate(t,e,-Math.PI/2),o.scale(t,t,i),t},o.crossZV=function(t,e,i){return o.rotate(t,i,Math.PI/2),o.scale(t,t,e),t},o.rotate=function(t,e,o){if(0!==o){var i=Math.cos(o),n=Math.sin(o),r=e[0],s=e[1];t[0]=i*r-n*s,t[1]=n*r+i*s}else t[0]=e[0],t[1]=e[1]},o.rotate90cw=function(t,e){var o=e[0],i=e[1];t[0]=i,t[1]=-o},o.toLocalFrame=function(t,e,i,n){o.copy(t,e),o.sub(t,t,i),o.rotate(t,t,-n)},o.toGlobalFrame=function(t,e,i,n){o.copy(t,e),o.rotate(t,t,n),o.add(t,t,i)},o.vectorToLocalFrame=function(t,e,i){o.rotate(t,e,-i)},o.vectorToGlobalFrame=function(t,e,i){o.rotate(t,e,i)},o.centroid=function(t,e,i,n){return o.add(t,e,i),o.add(t,t,n),o.scale(t,t,1/3),t},o.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var o=new i.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,o){return t[0]=e,t[1]=o,t},o.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},o.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},o.sub=o.subtract,o.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},o.mul=o.multiply,o.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},o.div=o.divide,o.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},o.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(o*o+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},o.len=o.length,o.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var o=e[0],i=e[1],n=o*o+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.lerp=function(t,e,o,i){var n=e[0],r=e[1];return t[0]=n+i*(o[0]-n),t[1]=r+i*(o[1]-r),t},o.reflect=function(t,e,o){var i=e[0]*o[0]+e[1]*o[1];t[0]=e[0]-2*o[0]*i,t[1]=e[1]-2*o[1]*i},o.getLineSegmentsIntersection=function(t,e,i,n,r){var s=o.getLineSegmentsIntersectionFraction(e,i,n,r);return!(0>s||(t[0]=e[0]+s*(i[0]-e[0]),t[1]=e[1]+s*(i[1]-e[1]),0))},o.getLineSegmentsIntersectionFraction=function(t,e,o,i){var n,r,s=e[0]-t[0],a=e[1]-t[1],c=i[0]-o[0],h=i[1]-o[1];return n=(-a*(t[0]-o[0])+s*(t[1]-o[1]))/(-c*a+s*h),r=(c*(t[1]-o[1])-h*(t[0]-o[0]))/(-c*a+s*h),n>=0&&1>=n&&r>=0&&1>=r?r:-1}},{"../utils/Utils":57}],31:[function(t,e){function o(t){t=t||{},h.call(this),this.id=t.id||++o._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=i.create(),this.position=i.fromValues(0,0),t.position&&i.copy(this.position,t.position),this.interpolatedPosition=i.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=i.fromValues(0,0),this.previousAngle=0,this.velocity=i.fromValues(0,0),t.velocity&&i.copy(this.velocity,t.velocity),this.vlambda=i.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=i.create(),t.force&&i.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=o.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=o.DYNAMIC:this.type=o.STATIC,this.boundingRadius=0,this.aabb=new c,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var i=t("../math/vec2"),n=t("poly-decomp"),r=t("../shapes/Convex"),s=t("../collision/RaycastResult"),a=t("../collision/Ray"),c=t("../collision/AABB"),h=t("../events/EventEmitter");e.exports=o,o.prototype=new h,o.prototype.constructor=o,o._idCounter=0,o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},o.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new c,p=i.create();o.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,o=p,n=this.angle,r=0;r!==e;r++){var s=t[r],a=s.angle+n;i.rotate(o,s.position,n),i.add(o,o,this.position),s.computeAABB(l,o,a),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,o=0,n=0;n!==e;n++){var r=t[n],s=i.length(r.position),a=r.boundingRadius;s+a>o&&(o=s+a)}this.boundingRadius=o},o.prototype.addShape=function(t,e,o){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?i.copy(t.position,e):i.set(t.position,0,0),t.angle=o||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,n=this.mass/e,r=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var s=0;e>s;s++){var a=t[s],c=i.squaredLength(a.position);r+=a.computeMomentOfInertia(n)+n*c}this.inertia=r,this.invInertia=r>0?1/r:0}this.invMass=1/this.mass,i.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},i.create(),o.prototype.applyForce=function(t,e){if(i.add(this.force,this.force,t),e){var o=i.crossLength(e,t);this.angularForce+=o}};var u=i.create(),d=i.create(),f=i.create();o.prototype.applyForceLocal=function(t,e){e=e||f;var o=u,i=d;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyForce(o,i)};var v=i.create();o.prototype.applyImpulse=function(t,e){if(this.type===o.DYNAMIC){var n=v;if(i.scale(n,t,this.invMass),i.multiply(n,this.massMultiplier,n),i.add(this.velocity,n,this.velocity),e){var r=i.crossLength(e,t);r*=this.invInertia,this.angularVelocity+=r}}};var y=i.create(),m=i.create(),g=i.create();o.prototype.applyImpulseLocal=function(t,e){e=e||g;var o=y,i=m;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyImpulse(o,i)},o.prototype.toLocalFrame=function(t,e){i.toLocalFrame(t,e,this.position,this.angle)},o.prototype.toWorldFrame=function(t,e){i.toGlobalFrame(t,e,this.position,this.angle)},o.prototype.vectorToLocalFrame=function(t,e){i.vectorToLocalFrame(t,e,this.angle)},o.prototype.vectorToWorldFrame=function(t,e){i.vectorToGlobalFrame(t,e,this.angle)},o.prototype.fromPolygon=function(t,e){e=e||{};for(var o=this.shapes.length;o>=0;--o)this.removeShape(this.shapes[o]);var s,a=new n.Polygon;if(a.vertices=t,a.makeCCW(),"number"==typeof e.removeCollinearPoints&&a.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!a.isSimple())return!1;for(this.concavePath=a.vertices.slice(0),o=0;o<this.concavePath.length;o++){var c=[0,0];i.copy(c,this.concavePath[o]),this.concavePath[o]=c}s=e.optimalDecomp?a.decomp():a.quickDecomp();var h=i.create();for(o=0;o!==s.length;o++){for(var l=new r({vertices:s[o].vertices}),p=0;p!==l.vertices.length;p++)c=l.vertices[p],i.sub(c,c,l.centerOfMass);i.scale(h,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,h)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var A=(i.fromValues(0,0),i.fromValues(0,0)),b=i.fromValues(0,0),E=i.fromValues(0,0);o.prototype.adjustCenterOfMass=function(){var t=A,e=b,o=E,n=0;i.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var s=this.shapes[r];i.scale(t,s.position,s.area),i.add(e,e,t),n+=s.area}for(i.scale(o,e,1/n),r=0;r!==this.shapes.length;r++)s=this.shapes[r],i.sub(s.position,s.position,o);for(i.add(this.position,this.position,o),r=0;this.concavePath&&r<this.concavePath.length;r++)i.sub(this.concavePath[r],this.concavePath[r],o);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){i.set(this.force,0,0),this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var t=this.vlambda;i.set(t,0,0),this.wlambda=0},o.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;i.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},o.prototype.applyDamping=function(t){if(this.type===o.DYNAMIC){var e=this.velocity;i.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},o.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,t!==o.AWAKE&&this.emit(o.wakeUpEvent)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=0,this.angularForce=0,i.set(this.velocity,0,0),i.set(this.force,0,0),this.emit(o.sleepEvent)},o.prototype.sleepTick=function(t,e,n){this.allowSleep&&this.type!==o.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,i.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=n,this.sleepState=o.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},o.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var B=i.create(),q=i.create();o.prototype.integrate=function(t){var e=this.invMass,o=this.force,n=this.position,r=this.velocity;i.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),i.scale(B,o,t*e),i.multiply(B,this.massMultiplier,B),i.add(r,B,r),this.integrateToTimeOfImpact(t)||(i.scale(q,r,t),i.add(n,n,q),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var P=new s,w=new a({mode:a.ALL}),S=i.create(),C=i.create(),L=i.create(),x=i.create();o.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||i.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;i.normalize(S,this.velocity),i.scale(C,this.velocity,t),i.add(C,C,this.position),i.sub(L,C,this.position);var e,o=this.angularVelocity*t,n=i.length(L),r=1,s=this;if(P.reset(),w.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(C,w),i.sub(L,C,s.position),r=i.length(L)/n,t.stop())},i.copy(w.from,this.position),i.copy(w.to,C),w.update(),this.world.raycast(P,w),!e)return!1;var a=this.angle;i.copy(x,this.position);for(var c=0,h=0,l=0,p=r;p>=h&&c<this.ccdIterations;)c++,l=(p-h)/2,i.scale(q,L,r),i.add(this.position,x,q),this.angle=a+o*r,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?h=l:p=l;return r=l,i.copy(this.position,x),this.angle=a,i.scale(q,L,r),i.add(this.position,this.position,q),this.fixedRotation||(this.angle+=o*r),!0},o.prototype.getVelocityAtPoint=function(t,e){return i.crossVZ(t,e,this.angularVelocity),i.subtract(t,this.velocity,t),t},o.sleepyEvent={type:"sleepy"},o.sleepEvent={type:"sleep"},o.wakeUpEvent={type:"wakeup"},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e){function o(t,e,o){o=o||{},n.call(this,t,e,o),this.localAnchorA=i.fromValues(0,0),this.localAnchorB=i.fromValues(0,0),o.localAnchorA&&i.copy(this.localAnchorA,o.localAnchorA),o.localAnchorB&&i.copy(this.localAnchorB,o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB);var r=i.create(),s=i.create();this.getWorldAnchorA(r),this.getWorldAnchorB(s);var a=i.distance(r,s);this.restLength="number"==typeof o.restLength?o.restLength:a}var i=t("../math/vec2"),n=t("./Spring");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var r=i.create(),s=i.create(),a=i.create(),c=i.create(),h=i.create(),l=i.create(),p=i.create(),u=i.create(),d=i.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,n=this.bodyA,f=this.bodyB,v=r,y=s,m=a,g=c,A=d,b=h,E=l,B=p,q=u;this.getWorldAnchorA(b),this.getWorldAnchorB(E),i.sub(B,b,n.position),i.sub(q,E,f.position),i.sub(v,E,b);var P=i.len(v);i.normalize(y,v),i.sub(m,f.velocity,n.velocity),i.crossZV(A,f.angularVelocity,q),i.add(m,m,A),i.crossZV(A,n.angularVelocity,B),i.sub(m,m,A),i.scale(g,y,-t*(P-o)-e*i.dot(m,y)),i.sub(n.force,n.force,g),i.add(f.force,f.force,g);var w=i.crossLength(B,g),S=i.crossLength(q,g);n.angularForce-=w,f.angularForce+=S}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,o),this.restAngle="number"==typeof o.restAngle?o.restAngle:e.angle-t.angle}var i=(t("../math/vec2"),t("./Spring"));e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restAngle,i=this.bodyA,n=this.bodyB,r=-t*(n.angle-i.angle-o)-e*(n.angularVelocity-i.angularVelocity)*0;i.angularForce-=r,n.angularForce+=r}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e){function o(t,e,o){o=i.defaults(o,{stiffness:100,damping:1}),this.stiffness=o.stiffness,this.damping=o.damping,this.bodyA=t,this.bodyB=e}var i=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e){function o(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new a({mass:0}),this.world=null;var o=this;this.preStepCallback=function(){o.update()}}function i(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new s(t.chassisBody,t.groundBody),this.sideEquation=new s(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=n.fromValues(0,1),e.localForwardVector&&n.copy(this.localForwardVector,e.localForwardVector),this.localPosition=n.fromValues(0,0),e.localPosition&&n.copy(this.localPosition,e.localPosition),r.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var n=t("../math/vec2"),r=(t("../utils/Utils"),t("../constraints/Constraint")),s=t("../equations/FrictionEquation"),a=t("../objects/Body");e.exports=o,o.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.addConstraint(o)}},o.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.removeConstraint(o)}this.world=null},o.prototype.addWheel=function(t){var e=new i(this,t);return this.wheels.push(e),e},o.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},i.prototype=new r,i.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},i.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=n.create(),h=n.create();i.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,h),n.dot(c,h)};var l=n.create();i.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),n.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),n.normalize(l,this.forwardEquation.t),n.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e){var o=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(o,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,o=this.height=t.height||1,s=[i.fromValues(-e/2,-o/2),i.fromValues(e/2,-o/2),i.fromValues(e/2,o/2),i.fromValues(-e/2,o/2)],a=[i.fromValues(1,0),i.fromValues(0,1)];t.vertices=s,t.axes=a,t.type=n.BOX,r.call(this,t)}var i=t("../math/vec2"),n=t("./Shape"),r=t("./Convex");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.width,o=this.height;return t*(o*o+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},i.create(),i.create(),i.create(),i.create(),o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=i.CAPSULE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,o=this.length+e,i=2*e;return t*(i*i+o*o)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=n.create();o.prototype.computeAABB=function(t,e,o){var i=this.radius;n.set(r,this.length/2,0),0!==o&&n.rotate(r,r,o),n.set(t.upperBound,Math.max(r[0]+i,-r[0]+i),Math.max(r[1]+i,-r[1]+i)),n.set(t.lowerBound,Math.min(r[0]-i,-r[0]-i),Math.min(r[1]-i,-r[1]-i)),n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e)};var s=n.create(),a=n.create(),c=n.create(),h=n.create(),l=n.fromValues(0,1);o.prototype.raycast=function(t,e,o,i){for(var r=e.from,p=e.to,u=(e.direction,s),d=a,f=c,v=h,y=this.length/2,m=0;2>m;m++){var g=this.radius*(2*m-1);if(n.set(f,-y,g),n.set(v,y,g),n.toGlobalFrame(f,f,o,i),n.toGlobalFrame(v,v,o,i),(b=n.getLineSegmentsIntersectionFraction(r,p,f,v))>=0&&(n.rotate(d,l,i),n.scale(d,d,2*m-1),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}var A=Math.pow(this.radius,2)+Math.pow(y,2);for(m=0;2>m;m++){n.set(f,y*(2*m-1),0),n.toGlobalFrame(f,f,o,i);var b,E=Math.pow(p[0]-r[0],2)+Math.pow(p[1]-r[1],2),B=2*((p[0]-r[0])*(r[0]-f[0])+(p[1]-r[1])*(r[1]-f[1])),q=Math.pow(r[0]-f[0],2)+Math.pow(r[1]-f[1],2)-Math.pow(this.radius,2);if(!(0>(b=Math.pow(B,2)-4*E*q)))if(0===b){if(n.lerp(u,r,p,b),n.squaredDistance(u,o)>A&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}else{var P=Math.sqrt(b),w=1/(2*E),S=(-B-P)*w,C=(-B+P)*w;if(S>=0&&1>=S&&(n.lerp(u,r,p,S),n.squaredDistance(u,o)>A&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,S,d,-1),t.shouldStop(e))))return;if(C>=0&&1>=C&&(n.lerp(u,r,p,C),n.squaredDistance(u,o)>A&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,C,d,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e){function o(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=i.CIRCLE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e){var o=this.radius;n.set(t.upperBound,o,o),n.set(t.lowerBound,-o,-o),e&&(n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e))};var r=n.create(),s=n.create();o.prototype.raycast=function(t,e,o){var i=e.from,a=e.to,c=this.radius,h=Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2),l=2*((a[0]-i[0])*(i[0]-o[0])+(a[1]-i[1])*(i[1]-o[1])),p=Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)-Math.pow(c,2),u=Math.pow(l,2)-4*h*p,d=r,f=s;if(!(0>u))if(0===u)n.lerp(d,i,a,u),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,u,f,-1);else{var v=Math.sqrt(u),y=1/(2*h),m=(-l-v)*y,g=(-l+v)*y;if(m>=0&&1>=m&&(n.lerp(d,i,a,m),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,m,f,-1),t.shouldStop(e)))return;g>=0&&1>=g&&(n.lerp(d,i,a,g),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,g,f,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e){function o(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],o=0;o<e.length;o++){var r=n.create();n.copy(r,e[o]),this.vertices.push(r)}if(this.axes=[],t.axes)for(o=0;o<t.axes.length;o++){var s=n.create();n.copy(s,t.axes[o]),this.axes.push(s)}else for(o=0;o<this.vertices.length;o++){var a=this.vertices[o],c=this.vertices[(o+1)%this.vertices.length],h=n.create();n.sub(h,c,a),n.rotate90cw(h,h),n.normalize(h,h),this.axes.push(h)}if(this.centerOfMass=n.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=i.CONVEX,i.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var i=t("./Shape"),n=t("../math/vec2"),r=t("../math/polyk");t("poly-decomp"),e.exports=o,o.prototype=new i,o.prototype.constructor=o;var s=n.create(),a=n.create();o.prototype.projectOntoLocalAxis=function(t,e){for(var o,i,r=null,a=null,c=(t=s,0);c<this.vertices.length;c++)o=this.vertices[c],i=n.dot(o,t),(null===r||i>r)&&(r=i),(null===a||a>i)&&(a=i);if(a>r){var h=a;a=r,r=h}n.set(e,a,r)},o.prototype.projectOntoWorldAxis=function(t,e,o,i){var r=a;this.projectOntoLocalAxis(t,i),0!==o?n.rotate(r,t,o):r=t;var s=n.dot(e,r);n.set(i,i[0]+s,i[1]+s)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var o=this.vertices[e];t.push(o[0],o[1])}var i=r.Triangulate(t);for(e=0;e<i.length;e+=3){var n=i[e],s=i[e+1],a=i[e+2];this.triangles.push([n,s,a])}};var c=n.create(),h=n.create(),l=n.create(),p=n.create(),u=n.create();n.create(),n.create(),n.create(),n.create(),o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,r=c,s=l,a=p,d=u,f=h;n.set(i,0,0);for(var v=0,y=0;y!==t.length;y++){var m=t[y];s=e[m[0]],a=e[m[1]],d=e[m[2]],n.centroid(r,s,a,d);var g=o.triangleArea(s,a,d);v+=g,n.scale(f,r,g),n.add(i,i,f)}n.scale(i,i,1/v)},o.prototype.computeMomentOfInertia=function(t){for(var e=0,o=0,i=this.vertices.length,r=i-1,s=0;i>s;r=s,s++){var a=this.vertices[r],c=this.vertices[s],h=Math.abs(n.crossLength(a,c));e+=h*(n.dot(c,c)+n.dot(c,a)+n.dot(a,a)),o+=h}return t/6*(e/o)},o.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,o=0;o!==t.length;o++){var i=n.squaredLength(t[o]);i>e&&(e=i)}this.boundingRadius=Math.sqrt(e)},o.triangleArea=function(t,e,o){return.5*((e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1]))},o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],r=e[n[0]],s=e[n[1]],a=e[n[2]],c=o.triangleArea(r,s,a);this.area+=c}},o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)};var d=n.create(),f=n.create(),v=n.create();o.prototype.raycast=function(t,e,o,i){var r=d,s=f,a=v,c=this.vertices;n.toLocalFrame(r,e.from,o,i),n.toLocalFrame(s,e.to,o,i);for(var h=c.length,l=0;h>l&&!t.shouldStop(e);l++){var p=c[l],u=c[(l+1)%h],y=n.getLineSegmentsIntersectionFraction(r,s,p,u);y>=0&&(n.sub(a,u,p),n.rotate(a,a,-Math.PI/2+i),n.normalize(a,a),e.reportIntersection(t,y,a,l))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e){function o(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,(void 0===t.maxValue||void 0===t.minValue)&&this.updateMaxMinValues(),t.type=i.HEIGHTFIELD,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],o=t[0],i=0;i!==t.length;i++){var n=t[i];n>e&&(e=n),o>n&&(o=n)}this.maxValue=e,this.minValue=o},o.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,o=0;o<t.length-1;o++)e+=(t[o]+t[o+1])/2*this.elementWidth;this.area=e};var r=[n.create(),n.create(),n.create(),n.create()];o.prototype.computeAABB=function(t,e,o){n.set(r[0],0,this.maxValue),n.set(r[1],this.elementWidth*this.heights.length,this.maxValue),n.set(r[2],this.elementWidth*this.heights.length,this.minValue),n.set(r[3],0,this.minValue),t.setFromPoints(r,e,o)},o.prototype.getLineSegment=function(t,e,o){var i=this.heights,r=this.elementWidth;n.set(t,o*r,i[o]),n.set(e,(o+1)*r,i[o+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return Math.min(this.heights.length,Math.max(e,0))};var s=(n.create(),n.create()),a=n.create(),c=n.create(),h=n.create(),l=n.create();n.fromValues(0,1),o.prototype.raycast=function(t,e,o,i){var r=e.from,p=e.to,u=(e.direction,s),d=a,f=c,v=h,y=l;n.toLocalFrame(v,r,o,i),n.toLocalFrame(y,p,o,i);var m=this.getClampedSegmentIndex(v),g=this.getClampedSegmentIndex(y);if(m>g){var A=m;m=g,g=A}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(d,f,b);var E=n.getLineSegmentsIntersectionFraction(v,y,d,f);if(E>=0&&(n.sub(u,f,d),n.rotate(u,u,i+Math.PI/2),n.normalize(u,u),e.reportIntersection(t,E,u,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e){function o(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=i.LINE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var r=[n.create(),n.create()];o.prototype.computeAABB=function(t,e,o){var i=this.length/2;n.set(r[0],-i,0),n.set(r[1],i,0),t.setFromPoints(r,e,o,0)};var s=(n.create(),n.create()),a=n.create(),c=n.create(),h=n.fromValues(0,1);o.prototype.raycast=function(t,e,o,i){var r=e.from,l=e.to,p=a,u=c,d=this.length/2;n.set(p,-d,0),n.set(u,d,0),n.toGlobalFrame(p,p,o,i),n.toGlobalFrame(u,u,o,i);var f=n.getLineSegmentsIntersectionFraction(p,u,r,l);if(f>=0){var v=s;n.rotate(v,h,i),e.reportIntersection(t,f,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e){function o(t){(t=t||{}).type=i.PARTICLE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e){n.copy(t.lowerBound,e),n.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e){function o(t){(t=t||{}).type=i.PLANE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,o){var i=o%(2*Math.PI),r=n.set,s=1e7,a=t.lowerBound,c=t.upperBound;r(a,-s,-s),r(c,s,s),0===i?c[1]=0:i===Math.PI/2?a[0]=0:i===Math.PI?a[1]=0:i===3*Math.PI/2&&(c[0]=0)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var r=n.create(),s=(n.create(),n.create(),n.create()),a=n.create();o.prototype.raycast=function(t,e,o,i){var c=e.from,h=e.to,l=e.direction,p=r,u=s,d=a;n.set(u,0,1),n.rotate(u,u,i),n.sub(d,c,o);var f=n.dot(d,u);if(n.sub(d,h,o),!(f*n.dot(d,u)>0||n.squaredDistance(c,h)<f*f)){var v=n.dot(u,l);n.sub(p,c,o);var y=-n.dot(u,p)/v/e.length;e.reportIntersection(t,y,u,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e){function o(t){t=t||{},this.body=null,this.position=i.fromValues(0,0),t.position&&i.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=o;var i=t("../math/vec2");o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,Object.defineProperty(o,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),o.BOX}}),o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype.computeMomentOfInertia=function(){},o.prototype.updateBoundingRadius=function(){},o.prototype.updateArea=function(){},o.prototype.computeAABB=function(){},o.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(t,e){function o(t){r.call(this,t,r.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new s.ARRAY_TYPE(this.arrayStep),this.Bs=new s.ARRAY_TYPE(this.arrayStep),this.invCs=new s.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}function i(t){for(var e=t.length;e--;)t[e]=0}var n=t("../math/vec2"),r=t("./Solver"),s=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.solve=function(t,e){this.sortEquations();var r,c,h=0,l=this.iterations,p=this.frictionIterations,u=this.equations,d=u.length,f=Math.pow(this.tolerance*d,2),v=e.bodies,y=e.bodies.length,m=(n.add,n.set,this.useZeroRHS),g=this.lambda;if(this.usedIterations=0,d)for(var A=0;A!==y;A++)v[A].updateSolveMassProperties();g.length<d&&(g=this.lambda=new s.ARRAY_TYPE(d+this.arrayStep),this.Bs=new s.ARRAY_TYPE(d+this.arrayStep),this.invCs=new s.ARRAY_TYPE(d+this.arrayStep)),i(g);var b=this.invCs,E=this.Bs;for(A=(g=this.lambda,0);A!==u.length;A++){var B;((B=u[A]).timeStep!==t||B.needsUpdate)&&(B.timeStep=t,B.update()),E[A]=B.computeB(B.a,B.b,t),b[A]=B.computeInvC(B.epsilon)}if(0!==d){for(A=0;A!==y;A++)v[A].resetConstraintVelocity();if(p){for(h=0;h!==p;h++){for(r=0,c=0;c!==d;c++){B=u[c];var q=o.iterateEquation(c,B,B.epsilon,E,b,g,m,t,h);r+=Math.abs(q)}if(this.usedIterations++,f>=r*r)break}for(o.updateMultipliers(u,g,1/t),c=0;c!==d;c++){var P=u[c];if(P instanceof a){for(var w=0,S=0;S!==P.contactEquations.length;S++)w+=P.contactEquations[S].multiplier;w*=P.frictionCoefficient/P.contactEquations.length,P.maxForce=w,P.minForce=-w}}}for(h=0;h!==l;h++){for(r=0,c=0;c!==d;c++)B=u[c],q=o.iterateEquation(c,B,B.epsilon,E,b,g,m,t,h),r+=Math.abs(q);if(this.usedIterations++,f>=r*r)break}for(A=0;A!==y;A++)v[A].addConstraintVelocity();o.updateMultipliers(u,g,1/t)}},o.updateMultipliers=function(t,e,o){for(var i=t.length;i--;)t[i].multiplier=e[i]*o},o.iterateEquation=function(t,e,o,i,n,r,s,a){var c=i[t],h=n[t],l=r[t],p=e.computeGWlambda(),u=e.maxForce,d=e.minForce;s&&(c=0);var f=h*(c-p-o*l),v=l+f;return d*a>v?f=d*a-l:v>u*a&&(f=u*a-l),r[t]+=f,e.addToWlambda(f),f}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e){function o(t,e){t=t||{},i.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var i=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var n={bodies:[]};o.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),n.bodies.length=0,e.getBodies(n.bodies),n.bodies.length&&this.solve(t,n))},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,o=t.length;e!==o;e++){var i=t[e];i.enabled&&this.equations.push(i)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1,o.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../equations/ContactEquation"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../equations/FrictionEquation"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../world/IslandNode"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../world/Island"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e){function o(){this.overlappingShapesLastState=new i,this.overlappingShapesCurrentState=new i,this.recordPool=new n({size:16}),this.tmpDict=new i,this.tmpArray1=[]}var i=t("./TupleDictionary"),n=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils"),e.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,o=t.keys.length;o--;){var i=t.keys[o],n=t.getByKey(i);e.getByKey(i),n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,o,i){var n=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!n.get(e.id,i.id)){var r=this.recordPool.get();r.set(t,e,o,i),n.set(e.id,i.id,r)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var o=this.overlappingShapesCurrentState,i=o.keys.length;i--;){var n=o.keys[i],r=o.data[n];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,o){var i=t,n=e;(o=o||[]).length=0;for(var r=n.keys.length;r--;){var s=n.keys[r],a=n.data[s];if(!a)throw new Error("Key "+s+" had no data!");i.data[s]||o.push(a)}return o},o.prototype.isNewOverlap=function(t,e){var o=0|t.id,i=0|e.id,n=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!n.get(o,i)&&!!r.get(o,i)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var o=this.tmpDict,i=t.length;i--;){var n=t[i];o.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(i=o.keys.length;i--;)(n=o.getByKey(o.keys[i]))&&e.push(n.bodyA,n.bodyB);return o.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e){function o(t,e,o,i){this.shapeA=e,this.shapeB=i,this.bodyA=t,this.bodyB=o}e.exports=o,o.prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},{}],54:[function(t,e){function o(){n.apply(this,arguments)}var i=t("./OverlapKeeperRecord"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e){function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=o,o.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e){function o(){this.data={},this.keys=[]}var i=t("./Utils");e.exports=o,o.prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t|=0,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,o){if(!o)throw new Error("No data!");var i=this.getKey(t,e);return this.data[i]||this.keys.push(i),this.data[i]=o,i},o.prototype.reset=function(){for(var t=this.data,e=this.keys,o=e.length;o--;)delete t[e[o]];e.length=0},o.prototype.copy=function(t){this.reset(),i.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var o=t.keys[e];this.data[o]=t.data[o]}}},{"./Utils":57}],57:[function(t,e){function o(){}e.exports=o,o.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var o=0,i=e.length;o!==i;++o)t.push(e[o])},o.splice=function(t,e,o){o=o||1;for(var i=e,n=t.length-o;n>i;i++)t[i]=t[i+o];t.length=n},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(t,e){for(var o in e)t[o]=e[o]},o.defaults=function(t,e){for(var o in t=t||{},e)o in t||(t[o]=e[o]);return t}},{}],58:[function(t,e){function o(){this.equations=[],this.bodies=[]}var i=t("../objects/Body");e.exports=o,o.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];o.prototype.getBodies=function(t){var e=t||[],o=this.equations;n.length=0;for(var i=0;i!==o.length;i++){var r=o[i];-1===n.indexOf(r.bodyA.id)&&(e.push(r.bodyA),n.push(r.bodyA.id)),-1===n.indexOf(r.bodyB.id)&&(e.push(r.bodyB),n.push(r.bodyB.id))}return e},o.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===i.DYNAMIC&&!e.wantsToSleep)return!1}return!0},o.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},{"../objects/Body":31}],59:[function(t,e){function o(){this.nodePool=new i({size:16}),this.islandPool=new n({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var i=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),n=t("./../utils/IslandPool"),r=t("../objects/Body");e.exports=o,o.getUnvisitedNode=function(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!i.visited&&i.body.type===r.DYNAMIC)return i}return!1},o.prototype.visit=function(t,e,o){e.push(t.body);for(var i=t.equations.length,n=0;n!==i;n++){var r=t.equations[n];-1===o.indexOf(r)&&o.push(r)}},o.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var s,a=n.pop();s=o.getUnvisitedNode(a.neighbors);)s.visited=!0,this.visit(s,e,i),s.body.type===r.DYNAMIC&&n.push(s)},o.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var r=0;r!==e.length;r++){var s=this.nodePool.get();s.body=e[r],i.push(s)}for(var a=0;a!==n.length;a++){var c=n[a],h=(r=e.indexOf(c.bodyA),e.indexOf(c.bodyB)),l=i[r],p=i[h];l.neighbors.push(p),p.neighbors.push(l),l.equations.push(c),p.equations.push(c)}var u,d=this.islands;for(r=0;r<d.length;r++)this.islandPool.release(d[r]);for(d.length=0;u=o.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(u,f.bodies,f.equations),d.push(f)}return d}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e){function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=o,o.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e){function o(t){l.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new i,this.narrowphase=new y(this),this.islandManager=new A,this.gravity=n.fromValues(0,-9.78),t.gravity&&n.copy(this.gravity,t.gravity),this.frictionGravity=n.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new v,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new u,this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=o.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}var i=t("../solver/GSSolver"),n=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),r=t("../shapes/Circle"),s=t("../shapes/Convex"),a=(t("../shapes/Line"),t("../shapes/Plane")),c=t("../shapes/Capsule"),h=t("../shapes/Particle"),l=t("../events/EventEmitter"),p=t("../objects/Body"),u=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),d=t("../material/ContactMaterial"),f=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),v=t("../collision/SAPBroadphase"),y=t("../collision/Narrowphase"),m=t("../utils/Utils"),g=t("../utils/OverlapKeeper"),A=t("./IslandManager");t("../objects/RotationalSpring"),e.exports=o,o.prototype=new Object(l.prototype),o.prototype.constructor=o,o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(t){this.constraints.push(t)},o.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},o.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&m.splice(this.contactMaterials,e,1)},o.prototype.getContactMaterial=function(t,e){for(var o=this.contactMaterials,i=0,n=o.length;i!==n;i++){var r=o[i];if(r.materialA.id===t.id&&r.materialB.id===e.id||r.materialA.id===e.id&&r.materialB.id===t.id)return r}return!1},o.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&m.splice(this.constraints,e,1)};var b=(n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()),E=n.fromValues(0,0),B=n.fromValues(0,0);n.fromValues(0,0),n.fromValues(0,0),o.prototype.step=function(t,e,o){if(o=o||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&o>i;)this.internalStep(t),this.time+=t,this.accumulator-=t,i++;for(var r=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var a=this.bodies[s];n.lerp(a.interpolatedPosition,a.previousPosition,a.position,r),a.interpolatedAngle=a.previousAngle+r*(a.angle-a.previousAngle)}}};var q=[];o.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,r=this.bodies,s=this.gravity,a=this.solver,c=this.bodies.length,h=this.broadphase,l=this.narrowphase,u=this.constraints,d=b,f=(n.scale,n.add),v=(n.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var y=n.length(this.gravity);0===y&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=y)}if(this.applyGravity)for(var g=0;g!==c;g++){var A=(E=r[g]).force;E.type===p.DYNAMIC&&E.sleepState!==p.SLEEPING&&(n.scale(d,s,E.mass*E.gravityScale),f(A,A,d))}if(this.applySpringForces)for(g=0;g!==e;g++)i[g].applyForce();if(this.applyDamping)for(g=0;g!==c;g++){var E;(E=r[g]).type===p.DYNAMIC&&E.applyDamping(t)}var B=h.getCollisionPairs(this),P=this.disabledBodyCollisionPairs;for(g=P.length-2;g>=0;g-=2)for(var w=B.length-2;w>=0;w-=2)(P[g]===B[w]&&P[g+1]===B[w+1]||P[g+1]===B[w]&&P[g]===B[w+1])&&B.splice(w,2);var S=u.length;for(g=0;g!==S;g++){var C=u[g];if(!C.collideConnected)for(w=B.length-2;w>=0;w-=2)(C.bodyA===B[w]&&C.bodyB===B[w+1]||C.bodyB===B[w]&&C.bodyA===B[w+1])&&B.splice(w,2)}this.postBroadphaseEvent.pairs=B,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this),g=0;for(var L=B.length;g!==L;g+=2)for(var x=B[g],F=B[g+1],M=0,I=x.shapes.length;M!==I;M++)for(var R=x.shapes[M],V=R.position,T=R.angle,N=0,G=F.shapes.length;N!==G;N++){var O=F.shapes[N],U=O.position,k=O.angle,_=this.defaultContactMaterial;if(R.material&&O.material){var D=this.getContactMaterial(R.material,O.material);D&&(_=D)}this.runNarrowphase(l,x,R,V,T,F,O,U,k,_,this.frictionGravity)}for(g=0;g!==c;g++)(z=r[g])._wakeUpAfterNarrowphase&&(z.wakeUp(),z._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(q);var W=this.endContactEvent;for(N=q.length;N--;){var j=q[N];W.shapeA=j.shapeA,W.shapeB=j.shapeB,W.bodyA=j.bodyA,W.bodyB=j.bodyB,this.emit(W)}q.length=0}var X=this.preSolveEvent;for(X.contactEquations=l.contactEquations,X.frictionEquations=l.frictionEquations,this.emit(X),X.contactEquations=X.frictionEquations=null,S=u.length,g=0;g!==S;g++)u[g].update();if(l.contactEquations.length||l.frictionEquations.length||S)if(this.islandSplit){for(v.equations.length=0,m.appendArray(v.equations,l.contactEquations),m.appendArray(v.equations,l.frictionEquations),g=0;g!==S;g++)m.appendArray(v.equations,u[g].equations);for(v.split(this),g=0;g!==v.islands.length;g++)(H=v.islands[g]).equations.length&&a.solveIsland(t,H)}else{for(a.addEquations(l.contactEquations),a.addEquations(l.frictionEquations),g=0;g!==S;g++)a.addEquations(u[g].equations);this.solveConstraints&&a.solve(t,this),a.removeAllEquations()}for(g=0;g!==c;g++){var z;(z=r[g]).integrate(t)}for(g=0;g!==c;g++)r[g].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var Y=this.impactEvent;for(g=0;g!==l.contactEquations.length;g++){var K=l.contactEquations[g];K.firstImpact&&(Y.bodyA=K.bodyA,Y.bodyB=K.bodyB,Y.shapeA=K.shapeA,Y.shapeB=K.shapeB,Y.contactEquation=K,this.emit(Y))}}if(this.sleepMode===o.BODY_SLEEPING)for(g=0;g!==c;g++)r[g].sleepTick(this.time,!1,t);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(g=0;g!==c;g++)r[g].sleepTick(this.time,!0,t);for(g=0;g<this.islandManager.islands.length;g++){var H;(H=this.islandManager.islands[g]).wantsToSleep()&&H.sleep()}}this.stepping=!1;var Z=this.bodiesToBeRemoved;for(g=0;g!==Z.length;g++)this.removeBody(Z[g]);Z.length=0,this.emit(this.postStepEvent)},o.prototype.runNarrowphase=function(t,e,o,i,r,s,a,c,h,l,u){if(0!=(o.collisionGroup&a.collisionMask)&&0!=(a.collisionGroup&o.collisionMask)){n.rotate(E,i,e.angle),n.rotate(B,c,s.angle),n.add(E,E,e.position),n.add(B,B,s.position);var d,f=r+e.angle,v=h+s.angle;t.enableFriction=l.friction>0,t.frictionCoefficient=l.friction,d=e.type===p.STATIC||e.type===p.KINEMATIC?s.mass:s.type===p.STATIC||s.type===p.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=l.friction*u*d,t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&o.collisionResponse&&a.collisionResponse;var y=t[o.type|a.type],m=0;if(y){var g=o.sensor||a.sensor,A=t.frictionEquations.length;m=o.type<a.type?y.call(t,e,o,E,f,s,a,B,v,g):y.call(t,s,a,B,v,e,o,E,f,g);var b=t.frictionEquations.length-A;if(m){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&s.sleepState===p.AWAKE&&s.type!==p.STATIC&&n.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2)>=2*Math.pow(s.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0),s.allowSleep&&s.type===p.DYNAMIC&&s.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC&&n.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(s._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(e,o,s,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(o,a)){var q=this.beginContactEvent;if(q.shapeA=o,q.shapeB=a,q.bodyA=e,q.bodyB=s,q.contactEquations.length=0,"number"==typeof m)for(var P=t.contactEquations.length-m;P<t.contactEquations.length;P++)q.contactEquations.push(t.contactEquations[P]);this.emit(q)}if("number"==typeof m&&b>1)for(P=t.frictionEquations.length-b;P<t.frictionEquations.length;P++){var w=t.frictionEquations[P];w.setSlipForce(w.getSlipForce()/b)}}}}},o.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},o.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&m.splice(this.springs,e,1)},o.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},o.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(m.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},o.prototype.getBodyById=function(t){for(var e=this.bodies,o=0;o<e.length;o++){var i=e[o];if(i.id===t)return i}return!1},o.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},o.prototype.enableBodyCollision=function(t,e){for(var o=this.disabledBodyCollisionPairs,i=0;i<o.length;i+=2)if(o[i]===t&&o[i+1]===e||o[i+1]===t&&o[i]===e)return void o.splice(i,2)},o.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);var i=this.bodies;for(e=i.length-1;e>=0;e--)this.removeBody(i[e]);var n=this.springs;for(e=n.length-1;e>=0;e--)this.removeSpring(n[e]);var r=this.contactMaterials;for(e=r.length-1;e>=0;e--)this.removeContactMaterial(r[e]);o.apply(this)};var P=n.create(),w=(n.fromValues(0,0),n.fromValues(0,0));o.prototype.hitTest=function(t,e,o){o=o||0;var i=new p({position:t}),l=new h,u=t,d=P,f=w;i.addShape(l);for(var v=this.narrowphase,y=[],m=0,g=e.length;m!==g;m++)for(var A=e[m],b=0,E=A.shapes.length;b!==E;b++){var B=A.shapes[b];n.rotate(d,B.position,A.angle),n.add(d,d,A.position);var q=B.angle+A.angle;(B instanceof r&&v.circleParticle(A,B,d,q,i,l,u,0,!0)||B instanceof s&&v.particleConvex(i,l,u,0,A,B,d,q,!0)||B instanceof a&&v.particlePlane(i,l,u,0,A,B,d,q,!0)||B instanceof c&&v.particleCapsule(i,l,u,0,A,B,d,q,!0)||B instanceof h&&n.squaredLength(n.sub(f,d,t))<o*o)&&y.push(A)}return y},o.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,o=0;o!==e.length;o++)for(var i=e[o],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.stiffness=t,r.needsUpdate=!0}var s=this.contactMaterials;for(o=0;o!==s.length;o++)(i=s[o]).stiffness=i.frictionStiffness=t;(i=this.defaultContactMaterial).stiffness=i.frictionStiffness=t},o.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var o=this.constraints[e],i=0;i!==o.equations.length;i++){var n=o.equations[i];n.relaxation=t,n.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++)(o=this.contactMaterials[e]).relaxation=o.frictionRelaxation=t;(o=this.defaultContactMaterial).relaxation=o.frictionRelaxation=t};var S=new f,C=[];o.prototype.raycast=function(t,e){return e.getAABB(S),this.broadphase.aabbQuery(this,S,C),e.intersectBodies(t,C),C.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});